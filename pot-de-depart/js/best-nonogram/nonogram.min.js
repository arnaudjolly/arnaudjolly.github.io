!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Nonogram",[],t):"object"==typeof exports?exports.Nonogram=t():e.Nonogram=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:String(t)}e.r(t),e.d(t,{Creator:()=>L,Gui:()=>I,Puzzle:()=>u,Solver:()=>C});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,o;return t=e,o=[{key:"removeFromArray",value:function(e,t){var o=e.indexOf(t);return-1!==o&&e.splice(o,1),e}},{key:"getZeroFilledArray",value:function(e){return new Array(e).fill(0)}},{key:"cloneArray",value:function(e){return e.slice(0)}},{key:"getRandomIntBetween",value:function(e,t){var o=Math.ceil(e),n=Math.floor(t);return Math.floor(Math.random()*(n-o+1))+o}}],null&&n(t.prototype,null),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:String(t)}var u=function(){function e(t,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t||void 0===o)throw"width and height are required constructor parameters.";if(t<=0||o<=0||1===t&&1===o)throw"invalid dimensions: "+t.toString()+" x "+o.toString();this.width="number"==typeof t?t:parseInt(t.toString(),10),this.height="number"==typeof o?o:parseInt(o.toString(),10),this.totalCells=this.width*this.height,this.reset()}var t,o;return t=e,(o=[{key:"reset",value:function(){var e=this,t=r.getZeroFilledArray;this.creator=null,this.cells=[],this.rowHints=[],this.columnHints=[],this.grid=t(this.height).map((function(){return t(e.width)}))}},{key:"checkUserSolution",value:function(){return this.cells.every((function(e){var t=1===e.userSolution?1:0;return e.solution===t}))}},{key:"getRowCells",value:function(e){var t,o=[],n=e*this.width,i=n+this.width;for(t=n;t<i;t++)o.push(this.cells[t]);return o.length>0&&o}},{key:"getColumnCells",value:function(e){var t,o=[];for(t=e;t<this.cells.length;t+=this.width)o.push(this.cells[t]);return o.length>0&&o}},{key:"getCellByIndex",value:function(e){var t="number"!=typeof e?parseInt(e,10):e;return!!this.cells[t]&&this.cells[t]}}])&&s(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function h(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function d(e,t,o){return t&&h(e.prototype,t),o&&h(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:String(t)}var m=d((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=-1,this.column=-1,this.row=-1,this.solution=null,this.userSolution=null,this.aiSolution=null,Object.assign(this,t)}));function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function g(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function v(e,t,o){return t&&g(e.prototype,t),o&&g(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:String(t)}var z=v((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.index=-1,this.length=0,this.minimumSectionLength=0,this.sections=[],this.cells=[],this.solved=!1,Object.assign(this,t)}));function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,w(n.key),n)}}function w(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:String(t)}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.puzzle=t,this._reset()}var t,o;return t=e,(o=[{key:"solve",value:function(){var e,t,o,n,i,r,l=(new Date).getTime(),s=-1,a=1;for(this.isReset||this._reset(),this.isReset=!1,this._log("Starting solve algorithm","info");this._getProgress()>s&&this._getTotalSolved()<this.puzzle.cells.length;){for(t=(new Date).getTime(),s=this._getProgress(),i=0;i<this.lines.length;i++)(r=this.lines[i]).solved||this.eliminateImpossibleFits(r),r.solved||this.findKnownPositivesAndNegatives(r),r.solved||this.findSectionDefiningChains(r),r.solved||this.findAnchoredSections(r),r.solved||this.findCompletedSections(r),r.solved||this.findCompletedLines(r);o=((new Date).getTime()-t)/1e3,this._log("Pass "+a+" completed in "+o+" seconds :: "+this._getTotalSolved()+"/"+this.puzzle.cells.length+" cells solved","info"),a++}return e=this._getTotalSolved()===this.puzzle.cells.length,n=((new Date).getTime()-l)/1e3,this._log("Solve algorithm finished in "+n+" seconds.","info"),e?this._log("Solution Found.","success"):this._log("Could not find solution.","failure"),this.elapsedTime=n,e}},{key:"eliminateImpossibleFits",value:function(e){var t,o,n,i,l,s,a,u,c,h,d=0,f=e.length-e.minimumSectionLength;if(0===e.sections.length)for(c=0;c<e.cells.length;c++)this._setCellSolution(e.cells[c],0);for(h=0;h<e.length&&0===e.cells[h].aiSolution;h++)d++;for(h=e.length-1;h>=0&&0===e.cells[h].aiSolution;h--)f--;for(l=0;l<e.sections.length;l++){for(o=e.sections[l],i=r.cloneArray(o.possibleStartIndexes),s=0;s<o.possibleStartIndexes.length;s++)for(n=o.possibleStartIndexes[s],a=e.cells[n+o.length],(n<d||n>f)&&(i=r.removeFromArray(i,n)),a&&1===a.aiSolution&&(i=r.removeFromArray(i,n)),u=(u=n+o.length-1)>e.length-1?e.length-1:u,t=n;t<=u;t++)(t>e.length-1||0===e.cells[t].aiSolution)&&(i=r.removeFromArray(i,n));d+=o.length+1,f+=o.length+1,o.possibleStartIndexes=i}}},{key:"findKnownPositivesAndNegatives",value:function(e){var t,o,n,i,l,s,a,u,c,h,d=r.getZeroFilledArray(e.length);for(t=0;t<e.sections.length;t++){for(o=e.sections[t],n=r.getZeroFilledArray(e.length),i=0;i<o.possibleStartIndexes.length;i++)for(s=(l=o.possibleStartIndexes[i])+o.length-1,a=l;a<=s;a++)n[a]++,d[a]++;for(u=0;u<n.length;u++)c=n[u],(h=e.cells[u])&&null===h.aiSolution&&c===o.possibleStartIndexes.length&&this._setCellSolution(h,1)}for(u=0;u<d.length;u++)c=d[u],(h=e.cells[u])&&null===h.aiSolution&&0===c&&this._setCellSolution(h,0)}},{key:"findAnchoredSections",value:function(e){var t,o,n,i;if(e.sections.length>0){for(n=e.sections[0],i=e.sections[e.sections.length-1],o=null,t=0;t<e.cells.length&&null!==e.cells[t].aiSolution;t++)if(1===e.cells[t].aiSolution){o=[t,t+n.length-1];break}if(null!==o){for(t=o[0];t<=o[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[t]&&this._setCellSolution(e.cells[t],0)}for(o=null,t=e.cells.length-1;t>=0&&null!==e.cells[t].aiSolution;t--)if(1===e.cells[t].aiSolution){o=[t-i.length+1,t];break}if(null!==o){for(t=o[0];t<=o[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[o[0]-1]&&this._setCellSolution(e.cells[o[0]-1],0)}}}},{key:"findSectionDefiningChains",value:function(e){var t,o,n,i,l,s=[],a=0;for(l=r.cloneArray(e.sections).sort((function(e,t){return e.length>t.length?-1:1}))[0],t=0;t<e.cells.length;t++)1===(o=e.cells[t]).aiSolution&&(1!==a?(n={start:t,length:1},s.push(n)):n&&n.length++),a=o.aiSolution;for(i=0;i<s.length;i++)(n=s[i]).length===l.length&&(e.cells[n.start-1]&&this._setCellSolution(e.cells[n.start-1],0),e.cells[n.start+l.length]&&this._setCellSolution(e.cells[n.start+l.length],0),l.solved=!0)}},{key:"findCompletedSections",value:function(e){var t,o,n,i;for(t=0;t<e.sections.length;t++)(o=e.sections[t]).solved||1!==o.possibleStartIndexes.length||(n=o.possibleStartIndexes[0]-1,i=o.possibleStartIndexes[0]+o.length,e.cells[n]&&null===e.cells[n].aiSolution&&this._setCellSolution(e.cells[n],0),e.cells[i]&&null===e.cells[i].aiSolution&&this._setCellSolution(e.cells[i],0),o.solved=!0)}},{key:"findCompletedLines",value:function(e){var t,o,n,i=0,r=0;for(t=0;t<e.sections.length;t++)i+=e.sections[t].length;for(o=0;o<e.cells.length;o++)r+=1===(n=e.cells[o]).aiSolution;if(i===r)for(o=0;o<e.cells.length;o++)null===(n=e.cells[o]).aiSolution&&this._setCellSolution(n,0)}},{key:"_reset",value:function(){var e,t,o,n,i,r,l,s,a,u,c=[],h=[];for(this.isReset=!0,this.elapsedTime=0,this.solutionLog=[],this.lines=[],this._log("Resetting variables","info"),t=0;t<this.puzzle.cells.length;t++)this.puzzle.cells[t].aiSolution=null;for(e=0;e<this.puzzle.width;e++)c.push(e);for(e=0;e<this.puzzle.height;e++)h.push(e);for(o=0;o<this.puzzle.rowHints.length;o++)if(n=this.puzzle.rowHints[o],i=this.puzzle.getRowCells(o)){for(r=new z({type:"row",index:o,length:this.puzzle.width,cells:i}),l=0;l<n.length;l++)s=n[l],r.sections.push({index:l,length:s,possibleStartIndexes:c,knownIndexes:[],solved:!1}),r.minimumSectionLength+=s+1;r.minimumSectionLength--,this.lines.push(r)}for(a=0;a<this.puzzle.columnHints.length;a++){for(u=this.puzzle.columnHints[a],r=new z({type:"column",index:a,length:this.puzzle.height,cells:this.puzzle.getColumnCells(a)}),l=0;l<u.length;l++)s=u[l],r.sections.push({index:l,length:s,possibleStartIndexes:h,knownIndexes:[],solved:!1}),r.minimumSectionLength+=s+1;r.minimumSectionLength--,this.lines.push(r)}}},{key:"_setCellSolution",value:function(e,t){var o,n,i,r,l,s,a;if(null===e.aiSolution)for(o=0;o<this.lines.length;o++)if(i="row"===(n=this.lines[o]).type&&n.index===e.row,r="column"===n.type&&n.index===e.column,l=0,i||r){for(s=0;s<n.cells.length;s++)(a=n.cells[s]).index===e.index?(a.aiSolution=t,l++):null!==a.aiSolution&&l++;l===n.length&&(n.solved=!0)}}},{key:"_log",value:function(e,t){this.solutionLog.push({html:e,cssClass:t||"info"})}},{key:"_getTotalSolved",value:function(){var e,t=0;for(e=0;e<this.puzzle.cells.length;e++)t+=null!==this.puzzle.cells[e].aiSolution;return t}},{key:"_getProgress",value:function(){var e,t,o,n=0,i=0;for(e=0;e<this.lines.length;e++)for(n+=(t=this.lines[e]).sections.length*("row"===t.type?this.puzzle.width:this.puzzle.height),o=0;o<t.sections.length;o++)i+=t.sections[o].possibleStartIndexes.length;return n-i}}])&&b(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function k(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_(n.key),n)}}function _(e){var t=function(e,t){if("object"!=P(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==P(t)?t:String(t)}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,o,n;return t=e,n=[{key:"_populatePuzzleFromGrid",value:function(e,t){var o,n,i,r,l,s,a,u,c,h,d;for(e.reset(),e.grid=t,n=0;n<e.grid.length;n++){for(i=e.grid[n],c=[],e.rowHints[n]=[],r=0;r<i.length;r++)a=l=i[r],u=r>0?e.grid[n][r-1]:0,e.cells.push(new m({index:n*e.width+r,column:r,row:n,solution:l})),1===a&&0===u?c.push(1):0===a&&1===u?c.push(0):1===a&&1===u&&c[c.length-1]++;for(h=0;h<c.length;h++)(d=c[h])>0&&e.rowHints[n].push(d)}for(r=0;r<e.width;r++){for(e.columnHints[r]=[],o=[],s=r;s<e.totalCells;s+=e.width)i=Math.floor(s/e.width),a=e.grid[i][r],u=i>0?e.grid[i-1][r]:0,1===a&&0===u?o.push(1):0===a&&1===u?o.push(0):1===a&&1===u&&o[o.length-1]++;for(h=0;h<o.length;h++)(d=o[h])>0&&e.columnHints[r].push(d)}return e}}],(o=[{key:"createRandom",value:function(t,o,n){var i,l,s,a,c,h,d,f,m=(new Date).getTime(),p=!1,g="number"==typeof n&&n>=0&&n<=1;for(this.puzzle=new u(t,o),this._reset();!1===p;){for(l=g?n:r.getRandomIntBetween(200,800)/1e3,s=[],a=[],i=0,this._log("Creating random "+this.puzzle.width+"x"+this.puzzle.height+" puzzle with density of "+l+"..."),d=0;d<this.puzzle.totalCells;d++)i+=c=Math.random()<l?1:0,d%this.puzzle.width==0&&d>0&&(s.push(a),a=[]),a.push(c);0!==i?i!==this.puzzle.totalCells?(s.push(a),this.puzzle=e._populatePuzzleFromGrid(this.puzzle,s),(h=new C(this.puzzle)).solve()?(p=!0,f=((new Date).getTime()-m)/1e3,this._log("Puzzle is solvable - solved in "+h.elapsedTime+" seconds"),this._logLine(),this._log("Puzzle generated in "+f+" seconds."),this.creationTime=f,this.solvingTime=h.elapsedTime):this._log("Puzzle cannot be solved.  Trying again..."),this._logLine()):this._log("Generated puzzle has all cells filled.  Trying again..."):this._log("Generated puzzle has no cells filled.  Trying again...")}return this.puzzle.creator=this,this.puzzle}},{key:"createFromGrid",value:function(t){var o,n,i=new Date,r=0,l=0;if(this._reset(),this._log("creating puzzle from grid array."),!(t instanceof Array))throw"grid is not an array";return t.forEach((function(e,t){if(!(e instanceof Array))throw"grid is not a multi-dimensional array";if(0===r)r=e.length;else if(e.length!==r)throw"row "+t+" has an invalid length ("+e.length+") - expecting "+r;l++})),this._log("grid is valid"),this._log("populating "+r+"x"+l+" puzzle"),o=new u(r,l),this.puzzle=e._populatePuzzleFromGrid(o,t),this.puzzle.creator=this,new C(this.puzzle).solve()?(this._log("Puzzle is solvable."),this._logLine(),n=((new Date).getTime()-i)/1e3,this._log("Puzzle built and solved in "+n+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"createFromHints",value:function(e){var t,o,n,i,r,l=this,s=new Date;if(this._reset(),this._log("creating puzzle from hints"),"object"!==P(e)||!e.row||!e.column)throw'parameter passed to createFromHints() must be an object containing "row" and "column" properties';if(!(e.row instanceof Array&&e.column instanceof Array))throw"hints.row or hints.column must be an array.";return this._log("found row and column hints"),t=e.column.length,o=e.row.length,(n=new u(t,o)).rowHints=e.row,n.columnHints=e.column,n.creator=this,this._log("populating "+t+"x"+o+" puzzle"),n.grid.forEach((function(e,t){e.forEach((function(e,o){n.cells.push(new m({index:t*n.width+o,column:o,row:t}))}))})),this.puzzle=n,(i=new C(this.puzzle)).solve()?(this._log("Puzzle is solvable."),this._logLine(),i.puzzle.cells.forEach((function(e,t){var o=l.puzzle.getCellByIndex(t);o.aiSolution=e.aiSolution,o.solution=e.aiSolution})),r=((new Date).getTime()-s)/1e3,this._log("Puzzle built and solved in "+r+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"_log",value:function(e){this.log.push(e)}},{key:"_logLine",value:function(){this.log.push("-----------------------------------")}},{key:"_reset",value:function(){this.log=[],this.creationTime=0,this.solvingTime=0}}])&&k(t.prototype,o),n&&k(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function x(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,q(n.key),n)}}function q(e){var t=function(e,t){if("object"!=E(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:String(t)}var T=function(){function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.path=o,this.html="",this.onLoadedCallbacks=[],this.isLoaded=!1,this.loadedPromise=null}var t,o;return t=e,(o=[{key:"onLoad",value:function(e){this.onLoadedCallbacks.push(e)}},{key:"fireOnLoaded",value:function(){this.onLoadedCallbacks.forEach((function(e){e()}))}},{key:"load",value:function(){var e=this;return this.loadedPromise=new Promise((function(t){fetch(e.path).then((function(o){if(!o.ok)throw'loading failed for "'+e.path+'"';o.text().then((function(o){e.html=o,e.isLoaded=!0,e.fireOnLoaded(),t(e.name+" loaded and parsed")}))}))})),this.loadedPromise}},{key:"getNode",value:function(){var e=document.createElement("div");return e.innerHTML=this.html,e}}])&&x(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),j={Arnaud:{width:26,height:10,hints:{row:[[5,5,5,5],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,5,4,4],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[5,1,1,1,5]],column:[[10],[1,1],[1,1],[1,1],[1,1],[],[],[10],[1,1],[1,1],[1,1],[10],[],[],[10],[1,1],[1,1],[1,1],[1],[],[],[10],[1,1,1],[1,1,1],[1,1,1],[1,1]]}},"Small Example 1":{width:8,height:8,solutionGrid:[[0,0,0,0,1,1,1,0],[0,0,0,1,1,1,1,1],[0,0,0,1,1,1,1,1],[1,1,0,0,1,1,1,0],[0,1,0,1,1,1,1,1],[1,1,0,1,0,0,0,1],[1,1,0,1,1,1,1,1],[1,0,0,0,1,1,1,0]]},"Small Example 2":{width:8,height:8,hints:{row:[[3],[5],[5],[2,3],[1,5],[2,1,1],[2,5],[1,3]],column:[[1,3],[4],[],[2,3],[5,2],[5,2],[5,2],[2,3]]}},"Small Example 3":{width:10,height:10,hints:{column:[[3],[1,1],[1],[6],[8],[2,1],[4,1],[10],[3,1],[3]],row:[[4],[5],[2,3],[2,3],[2,1],[2,1],[2,1],[10],[1,1,1],[2,1,1]]}},"Medium Example 1":{width:16,height:18,hints:{column:[[5],[4,3,3],[7,6,2],[4,3,4,1],[3,2,4,1,2],[2,6,4],[3,3,1,1],[4,6,4],[6,4,1,1],[4,3,4,1],[7,6,2],[4,3,3],[5],[3],[5,3,3],[2,4,1,2]],row:[[5],[9],[3,5],[3,5,1],[4,4,2],[2,1,1,2,1],[2,2,1],[2,3,2,1],[7,2],[9,1],[2,2,2,2,2],[3,2,2,3,2],[4,1,1,6],[1,2,2,2],[16],[2,1,1,1,1,2,1],[2,2,2,2,2],[9,1]]}},"Medium Example 2":{width:15,height:15,hints:{column:[[4],[3,1],[2,3],[1,2,2],[1,2,1],[1,1,1,1],[4,3,3],[2,2,4,3],[1,2,5,1],[1,2,4,1],[1,2,5,1],[2,2,4,3],[9,3],[5,1,1],[6,1]],row:[[4,5],[3,2,2],[2,1,1],[1,4,3],[2,9],[2,8],[2,3],[12],[1,7,1],[9],[5],[1,1],[2,2],[3,3],[1,7,1]]}},"Large Example 1":{width:30,height:30,hints:{column:[[19,9],[13,1,2,1,5],[11,4,1,1,2,3],[10,6,1,4,1,1],[9,7,1,1,3,2],[3,4,11,1,6],[2,1,2,3,3,3,7],[2,2,1,2,4,3,8],[3,2,2,1,2,6,7],[1,3,3,4,1,4,4,1],[5,4,2,5,2,2],[1,3,11,1,2,4],[3,2,14,5],[2,2,1,14,7],[1,2,2,2,10,2],[2,1,3,2,6,3,3],[5,6,6,2,2,4],[6,4,4,3,3,3],[6,3,2,1,1,3,5,2],[6,1,2,2,2,2,2,3],[7,1,9,2,4],[7,3,1,2,2,3],[8,2,5,4,3],[6,1,7,11],[5,1,3,2,12],[5,2,2,2,3,11],[4,5,4,3,10],[3,14,10],[3,3,5,2,9],[4,3,3,10]],row:[[10,19],[9,1,2,15],[6,1,1,1,14],[5,2,3,2,11,1],[6,7,11,1],[7,5,7,3],[8,4,3,4],[6,4,5,1,4,1],[5,8,6,2,1],[4,10,3,3,3,1],[3,3,5,2,4,2,2],[2,3,3,3,2,4,2,3],[2,3,1,1,5,2,1,6],[1,4,3,4,2,2,2,4],[1,4,3,4,5,3,3],[1,5,5,2,1,4,1,1],[1,15,3,2,3,1],[2,4,7,2,2,3,1],[1,4,4,7,2,1,3],[1,2,3,4,3,3,1],[1,1,3,5,2,6,1],[1,1,1,4,4,9],[2,3,1,1,1,9],[1,2,4,1,1,6,8],[1,10,1,7,7],[2,8,2,1,2,1,7],[3,6,3,1,1,1,7],[4,4,4,3,11],[3,5,20],[2,7,19]]}}};function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function O(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,H(n.key),n)}}function H(e){var t=function(e,t){if("object"!=A(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==A(t)?t:String(t)}var I=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=document.querySelector("head"),i=document.createElement("link");this.boardSizes=[{name:"Tiny",handle:"tiny",size:1},{name:"Small",handle:"small",size:2},{name:"Medium",handle:"medium",size:3},{name:"Large",handle:"large",size:4}],this.boardSize=this.boardSizes[2],this.themePath=t||"./themes/default",this.themeStylesheetPath=this.themePath+"/styles.css",i.rel="stylesheet",i.type="text/css",i.href=this.themeStylesheetPath,n.prepend(i),this.templatesLoaded=[],this.themeTemplatesPath=this.themePath+"/templates",this.templates=[new T("gameControls",this.themeTemplatesPath+"/controls-game.html"),new T("generateControls",this.themeTemplatesPath+"/controls-generate.html"),new T("console",this.themeTemplatesPath+"/console.html"),new T("previewGrid",this.themeTemplatesPath+"/preview-grid.html"),new T("puzzleGrid",this.themeTemplatesPath+"/puzzle-grid.html")],this.templates.forEach((function(e){o.templatesLoaded.push(e.load())})),this.mouseDown=!1,this.selection=new Set}var t,o,n;return t=e,n=[{key:"_keypressCallback",value:function(e){e.key&&"x"===e.key&&document.querySelector("#nonogram-puzzle-fill-mode").dispatchEvent(new MouseEvent("click"))}}],(o=[{key:"draw",value:function(e){var t=this;this.puzzle=e,Promise.all(this.templatesLoaded).then((function(){t.drawGenerateControls(),t.drawPuzzle(e),t.drawGameControls(),t.drawConsole()}))}},{key:"drawPuzzle",value:function(e){var t=this;Promise.all(this.templatesLoaded).then((function(){var o=t._getTemplate("puzzleGrid");if(t.puzzle=e,t.gridContainer=document.querySelector("[data-nonogram-puzzle-grid]"),t.gridContainer){var n=t.gridContainer,i=o.getNode(),r=i.querySelector("[data-nonogram-puzzle-grid-table-thead-th]"),l=i.querySelector("[data-nonogram-puzzle-grid-table-row]"),s={tl:0,tr:t.puzzle.width-1,bl:t.puzzle.width*t.puzzle.height-t.puzzle.width,br:t.puzzle.width*t.puzzle.height-1};t.puzzle.columnHints.forEach((function(e,t){var o=document.importNode(r.content,!0).querySelector("th"),n=o.querySelector(".fill");o.setAttribute("data-column",t.toString()),o.classList.add("hint","top"),e.forEach((function(e){var t=document.createElement("span");t.textContent=e,n.appendChild(t)})),r.parentNode.insertBefore(o,r)})),t.puzzle.grid.forEach((function(e,o){var n=t.puzzle.getRowCells(o),i=document.importNode(l.content,!0).querySelector("tr"),r=i.querySelector("[data-nonogram-puzzle-grid-table-cell]"),a=i.querySelector("[data-row-hints] .fill");i.setAttribute("data-row",o.toString()),t.puzzle.rowHints[o].forEach((function(e){var t=document.createElement("span");t.textContent=e,a.appendChild(t)})),n.forEach((function(e){var t=document.importNode(r.content,!0).querySelector("td");t.setAttribute("data-index",e.index),t.setAttribute("data-column",e.column),t.setAttribute("data-row",e.row),t.classList.add("puzzle-cell","flippable"),Object.keys(s).forEach((function(o){e.index===s[o]&&t.classList.add(o)})),i.appendChild(t)})),l.parentNode.appendChild(i)})),n.innerHtml=n.textContent="",n.appendChild(i),document.querySelector("[data-nonogram-puzzle-grid-table]").classList.add(t.boardSize.handle),t._resizeBoardForAvailableScreen(),t._makePuzzlePlayable(),t.drawPreview("userSolution")}}))}},{key:"drawGameControls",value:function(){var t=this;Promise.all(this.templatesLoaded).then((function(){var o,n=t._getTemplate("gameControls"),i=document.querySelector("[data-nonogram-game-controls]"),r=n.getNode();i&&(i.innerHtml=i.textContent="",i.appendChild(r),(o=document.querySelector("#nonogram-puzzle-fill-mode")).addEventListener("change",(function(){var e=document.querySelector('[for="nonogram-puzzle-fill-mode"]'),n=e.querySelector(".active"),i=e.querySelector(".inactive");n.classList.remove("active"),n.classList.add("inactive"),i.classList.remove("inactive"),i.classList.add("active"),o.checked?(e.classList.add("on"),t.playerClickMode=0):(e.classList.remove("on"),t.playerClickMode=1)})),window.removeEventListener("keyup",e._keypressCallback),window.addEventListener("keyup",e._keypressCallback))}))}},{key:"drawGenerateControls",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){var t,o,n,i,r,l,s,a,u,c,h,d,f,m,p=e._getTemplate("generateControls"),g=document.querySelector("[data-nonogram-generate-controls]"),v=p.getNode(),y=v.querySelector("[data-nonogram-generate-width]"),z=v.querySelector("[data-nonogram-generate-height]"),S=v.querySelector("[data-nonogram-generate-width-options]"),b=v.querySelector("[data-nonogram-generate-height-options]"),w=v.querySelector("[data-nonogram-choose-predefined]"),C=v.querySelector("[data-nonogram-board-size]"),P=v.querySelector("[data-nonogram-board-size-options]");if(g){for(t=5;t<=30;t++)o=document.importNode(S.content,!0),n=document.importNode(b.content,!0),(i=o.querySelector("option")).textContent=i.value=t,(r=n.querySelector("option")).textContent=r.value=t,e.puzzle.width===t&&i.setAttribute("selected","selected"),e.puzzle.height===t&&r.setAttribute("selected","selected"),y.appendChild(i),z.appendChild(r);Object.keys(j).forEach((function(t){l=document.importNode(S.content,!0),(s=l.querySelector("option")).textContent=s.value=t,t===e.selectedExample&&s.setAttribute("selected","selected"),w.appendChild(s)})),e.boardSizes.forEach((function(t){c=document.importNode(P.content,!0),(h=c.querySelector("option")).value=t.handle,h.textContent=t.name,t.handle===e.boardSize.handle&&h.setAttribute("selected","selected"),C.appendChild(h)})),g.innerHtml=g.textContent="",g.appendChild(v),m=document.querySelector("[data-nonogram-generate-button]"),a=document.querySelector("[data-nonogram-choose-predefined]"),u=document.querySelector("[data-nonogram-board-size]"),d=document.querySelector("[data-nonogram-game-reset]"),f=document.querySelector("[data-nonogram-game-solve]"),m.addEventListener("click",(function(){var t=document.querySelector("[data-nonogram-generate-width]"),o=document.querySelector("[data-nonogram-generate-height]"),n=t.value,i=o.value,r=(new L).createRandom(n,i,null);e.selectedExample=null,e.draw(r),e._resizeBoardForAvailableScreen()})),a.addEventListener("change",(function(){var t,o,n=new L;""!==a.value&&(Object.keys(j).forEach((function(i){a.value===i&&(t=j[i],e.selectedExample=i,t.solutionGrid?o=n.createFromGrid(t.solutionGrid):t.hints&&(o=n.createFromHints(t.hints)))})),o&&(e.draw(o),e._resizeBoardForAvailableScreen()))})),u.addEventListener("change",(function(){e.boardSizes.forEach((function(t){t.handle===u.value&&e._changeBoardSize(t)}))})),d.addEventListener("click",(function(){e._resetPuzzle()})),f.addEventListener("click",(function(){e.drawSolution(),e.drawPreview("solution"),e._showPuzzleSolved()}))}}))}},{key:"drawConsole",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){var t=e._getTemplate("console"),o=document.querySelector("[data-nonogram-console]"),n=t.getNode(),i=n.querySelector("[data-nonogram-console-output]"),r=n.querySelector("[data-nonogram-console-line]");o&&(e.puzzle.creator instanceof L&&e.puzzle.creator.log.forEach((function(e){var t=document.importNode(r.content,!0).querySelector("code");t.textContent=e.toString(),i.appendChild(t)})),o.innerHtml=o.textContent="",o.appendChild(n))}))}},{key:"drawPreview",value:function(e){var t=this;Promise.all(this.templatesLoaded).then((function(){var o=t._getTemplate("previewGrid"),n=document.querySelector("[data-nonogram-preview-grid]"),i=o.getNode();n.innerHtml=n.textContent="",n.appendChild(i.querySelector("[data-nonogram-preview]"));var r,l=document.querySelector("[data-nonogram-preview-canvas]"),s=l.getContext("2d"),a=l.parentElement.parentElement.parentElement,u=a.offsetWidth,c=a.offsetHeight,h=u/c,d=t.puzzle.width/t.puzzle.height;r=h>d?Math.floor(c/t.puzzle.height):Math.floor(u/t.puzzle.width),l.width=r*t.puzzle.width,l.height=r*t.puzzle.height,t.puzzle.cells.forEach((function(t){1===t[e]&&s.fillRect(t.column*r,t.row*r,r,r)}))}))}},{key:"drawSolution",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){e.gridContainer.querySelectorAll("td.filled").forEach((function(e){e.classList.remove("filled","solution-positive","solution-negative","user-positive","user-negative","flipped")})),e.puzzle.cells.forEach((function(t){var o=e.gridContainer.querySelector('td[data-index="'+t.index+'"]');t.userSolution=t.solution,o.classList.add("user-solved"),1===t.solution?o.classList.add("solution-positive","user-positive","flipped"):o.classList.add("solution-negative","user-negative")}))}))}},{key:"_changeBoardSize",value:function(e){var t=document.querySelector("[data-nonogram-puzzle-grid-table]"),o=document.querySelector("[data-nonogram-board-size]");t&&o&&(t.classList.remove("tiny","small","medium","large"),t.classList.add(e.handle),o.value=e.handle,this.boardSize=e,this.drawPreview())}},{key:"_resizeBoardForAvailableScreen",value:function(){var e,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),o=this.gridContainer.clientWidth,n=this.boardSizes.sort((function(e,t){return e.size>t.size?-1:1}));if(t.clientWidth>o)for(e=0;e<n.length&&(n[e].size<this.boardSize.size&&this._changeBoardSize(n[e]),!(t.clientWidth<=o));e++);this.drawConsole()}},{key:"_flipCell",value:function(e){var t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),o=e.getAttribute("data-index"),n=this.puzzle.getCellByIndex(o),i=document.querySelector("[data-nonogram-puzzle-grid-solved]");n.userSolution=n.userSolution===this.playerClickMode?null:this.playerClickMode,t.classList.remove("solved"),e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative"),1===n.userSolution?e.classList.add("user-solved","user-positive"):0===n.userSolution&&e.classList.add("user-solved","user-negative"),e.classList.toggle("flipped"),this.drawPreview("userSolution"),this.puzzle.checkUserSolution()?this._showPuzzleSolved():i.textContent=""}},{key:"_makePuzzlePlayable",value:function(){var e=this,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),o=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),n=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td");this.playerClickMode=1,o.forEach((function(t){t.classList.add("playable"),t.addEventListener("mouseenter",(function(t){console.log("mouse ENTER !!");var o=t.currentTarget,i=o.getAttribute("data-row"),r=o.getAttribute("data-column"),l="".concat(r,",").concat(i);n.forEach((function(t){var o=t.getAttribute("data-row"),n=t.getAttribute("data-column");o===i||n===r?t.classList.add("row-column-highlight"):t.classList.remove("row-column-highlight"),e.mouseDown&&o===i&&n===r&&!e.selection.has(l)&&(e.selection.add(l),t.click())}))})),t.addEventListener("mousedown",(function(t){console.log("mouse DOWN!");var o=t.currentTarget;t.preventDefault(),e.mouseDown=!0,e.selection.clear(),e._flipCell(o)}))})),t.addEventListener("mouseleave",(function(){console.log("mouse LEAVE!"),n.forEach((function(e){e.classList.remove("row-column-highlight")}))})),window.addEventListener("mouseup",(function(t){console.log("mouse UP!"),t.preventDefault(),e.mouseDown=!1,e.selection.clear()}))}},{key:"_resetPuzzle",value:function(){var e=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),o=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.classList.remove("solved"),o.textContent="",this.puzzle.cells.forEach((function(e){e.userSolution=null})),e.forEach((function(e){e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative")})),this.gridContainer.querySelector("[data-nonogram-preview-grid]").innerHTML="",this.drawPreview("userSolution")}},{key:"_showPuzzleSolved",value:function(){var e=this.gridContainer.querySelector(".nonogram-puzzle-grid"),t=document.querySelectorAll("[data-nonogram-puzzle-grid-table] .puzzle-cell"),o=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.forEach((function(e){e.classList.remove("row-column-highlight")})),e.classList.add("solved"),o.textContent="Solved!"}},{key:"_getTemplate",value:function(e){var t=this.templates.find((function(t){return t.name===e}));if(!(t instanceof T))throw'"'+e+'" template not found.';return t}}])&&O(t.prototype,o),n&&O(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t})()));
//# sourceMappingURL=nonogram.js.map