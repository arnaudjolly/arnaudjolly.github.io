!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Nonogram",[],t):"object"==typeof exports?exports.Nonogram=t():e.Nonogram=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function i(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:String(t)}e.r(t),e.d(t,{Creator:()=>L,Gui:()=>I,Puzzle:()=>u});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"removeFromArray",value:function(e,t){var n=e.indexOf(t);return-1!==n&&e.splice(n,1),e}},{key:"getZeroFilledArray",value:function(e){return new Array(e).fill(0)}},{key:"cloneArray",value:function(e){return e.slice(0)}},{key:"getRandomIntBetween",value:function(e,t){var n=Math.ceil(e),o=Math.floor(t);return Math.floor(Math.random()*(o-n+1))+n}}],null&&o(t.prototype,null),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,a(o.key),o)}}function a(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=l(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:String(t)}var u=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t||void 0===n)throw"width and height are required constructor parameters.";if(t<=0||n<=0||1===t&&1===n)throw"invalid dimensions: "+t.toString()+" x "+n.toString();this.width="number"==typeof t?t:parseInt(t.toString(),10),this.height="number"==typeof n?n:parseInt(n.toString(),10),this.totalCells=this.width*this.height,this.reset()}var t,n;return t=e,(n=[{key:"reset",value:function(){var e=this,t=r.getZeroFilledArray;this.creator=null,this.cells=[],this.rowHints=[],this.columnHints=[],this.grid=t(this.height).map((function(){return t(e.width)}))}},{key:"checkUserSolution",value:function(){return this.cells.every((function(e){var t=1===e.userSolution?1:0;return e.solution===t}))}},{key:"getRowCells",value:function(e){var t,n=[],o=e*this.width,i=o+this.width;for(t=o;t<i;t++)n.push(this.cells[t]);return n.length>0&&n}},{key:"getColumnCells",value:function(e){var t,n=[];for(t=e;t<this.cells.length;t+=this.width)n.push(this.cells[t]);return n.length>0&&n}},{key:"getCellByIndex",value:function(e){var t="number"!=typeof e?parseInt(e,10):e;return!!this.cells[t]&&this.cells[t]}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,f(o.key),o)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=c(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:String(t)}var m=d((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=-1,this.column=-1,this.row=-1,this.solution=null,this.userSolution=null,this.aiSolution=null,Object.assign(this,t)}));function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,y(o.key),o)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=p(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:String(t)}var z=v((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.index=-1,this.length=0,this.minimumSectionLength=0,this.sections=[],this.cells=[],this.solved=!1,Object.assign(this,t)}));function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,w(o.key),o)}}function w(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=S(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:String(t)}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.puzzle=t,this._reset()}var t,n;return t=e,(n=[{key:"solve",value:function(){var e,t,n,o,i,r,l=(new Date).getTime(),s=-1,a=1;for(this.isReset||this._reset(),this.isReset=!1,this._log("Starting solve algorithm","info");this._getProgress()>s&&this._getTotalSolved()<this.puzzle.cells.length;){for(t=(new Date).getTime(),s=this._getProgress(),i=0;i<this.lines.length;i++)(r=this.lines[i]).solved||this.eliminateImpossibleFits(r),r.solved||this.findKnownPositivesAndNegatives(r),r.solved||this.findSectionDefiningChains(r),r.solved||this.findAnchoredSections(r),r.solved||this.findCompletedSections(r),r.solved||this.findCompletedLines(r);n=((new Date).getTime()-t)/1e3,this._log("Pass "+a+" completed in "+n+" seconds :: "+this._getTotalSolved()+"/"+this.puzzle.cells.length+" cells solved","info"),a++}return e=this._getTotalSolved()===this.puzzle.cells.length,o=((new Date).getTime()-l)/1e3,this._log("Solve algorithm finished in "+o+" seconds.","info"),e?this._log("Solution Found.","success"):this._log("Could not find solution.","failure"),this.elapsedTime=o,e}},{key:"eliminateImpossibleFits",value:function(e){var t,n,o,i,l,s,a,u,c,h,d=0,f=e.length-e.minimumSectionLength;if(0===e.sections.length)for(c=0;c<e.cells.length;c++)this._setCellSolution(e.cells[c],0);for(h=0;h<e.length&&0===e.cells[h].aiSolution;h++)d++;for(h=e.length-1;h>=0&&0===e.cells[h].aiSolution;h--)f--;for(l=0;l<e.sections.length;l++){for(n=e.sections[l],i=r.cloneArray(n.possibleStartIndexes),s=0;s<n.possibleStartIndexes.length;s++)for(o=n.possibleStartIndexes[s],a=e.cells[o+n.length],(o<d||o>f)&&(i=r.removeFromArray(i,o)),a&&1===a.aiSolution&&(i=r.removeFromArray(i,o)),u=(u=o+n.length-1)>e.length-1?e.length-1:u,t=o;t<=u;t++)(t>e.length-1||0===e.cells[t].aiSolution)&&(i=r.removeFromArray(i,o));d+=n.length+1,f+=n.length+1,n.possibleStartIndexes=i}}},{key:"findKnownPositivesAndNegatives",value:function(e){var t,n,o,i,l,s,a,u,c,h,d=r.getZeroFilledArray(e.length);for(t=0;t<e.sections.length;t++){for(n=e.sections[t],o=r.getZeroFilledArray(e.length),i=0;i<n.possibleStartIndexes.length;i++)for(s=(l=n.possibleStartIndexes[i])+n.length-1,a=l;a<=s;a++)o[a]++,d[a]++;for(u=0;u<o.length;u++)c=o[u],(h=e.cells[u])&&null===h.aiSolution&&c===n.possibleStartIndexes.length&&this._setCellSolution(h,1)}for(u=0;u<d.length;u++)c=d[u],(h=e.cells[u])&&null===h.aiSolution&&0===c&&this._setCellSolution(h,0)}},{key:"findAnchoredSections",value:function(e){var t,n,o,i;if(e.sections.length>0){for(o=e.sections[0],i=e.sections[e.sections.length-1],n=null,t=0;t<e.cells.length&&null!==e.cells[t].aiSolution;t++)if(1===e.cells[t].aiSolution){n=[t,t+o.length-1];break}if(null!==n){for(t=n[0];t<=n[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[t]&&this._setCellSolution(e.cells[t],0)}for(n=null,t=e.cells.length-1;t>=0&&null!==e.cells[t].aiSolution;t--)if(1===e.cells[t].aiSolution){n=[t-i.length+1,t];break}if(null!==n){for(t=n[0];t<=n[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[n[0]-1]&&this._setCellSolution(e.cells[n[0]-1],0)}}}},{key:"findSectionDefiningChains",value:function(e){var t,n,o,i,l,s=[],a=0;for(l=r.cloneArray(e.sections).sort((function(e,t){return e.length>t.length?-1:1}))[0],t=0;t<e.cells.length;t++)1===(n=e.cells[t]).aiSolution&&(1!==a?(o={start:t,length:1},s.push(o)):o&&o.length++),a=n.aiSolution;for(i=0;i<s.length;i++)(o=s[i]).length===l.length&&(e.cells[o.start-1]&&this._setCellSolution(e.cells[o.start-1],0),e.cells[o.start+l.length]&&this._setCellSolution(e.cells[o.start+l.length],0),l.solved=!0)}},{key:"findCompletedSections",value:function(e){var t,n,o,i;for(t=0;t<e.sections.length;t++)(n=e.sections[t]).solved||1!==n.possibleStartIndexes.length||(o=n.possibleStartIndexes[0]-1,i=n.possibleStartIndexes[0]+n.length,e.cells[o]&&null===e.cells[o].aiSolution&&this._setCellSolution(e.cells[o],0),e.cells[i]&&null===e.cells[i].aiSolution&&this._setCellSolution(e.cells[i],0),n.solved=!0)}},{key:"findCompletedLines",value:function(e){var t,n,o,i=0,r=0;for(t=0;t<e.sections.length;t++)i+=e.sections[t].length;for(n=0;n<e.cells.length;n++)r+=1===(o=e.cells[n]).aiSolution;if(i===r)for(n=0;n<e.cells.length;n++)null===(o=e.cells[n]).aiSolution&&this._setCellSolution(o,0)}},{key:"_reset",value:function(){var e,t,n,o,i,r,l,s,a,u,c=[],h=[];for(this.isReset=!0,this.elapsedTime=0,this.solutionLog=[],this.lines=[],this._log("Resetting variables","info"),t=0;t<this.puzzle.cells.length;t++)this.puzzle.cells[t].aiSolution=null;for(e=0;e<this.puzzle.width;e++)c.push(e);for(e=0;e<this.puzzle.height;e++)h.push(e);for(n=0;n<this.puzzle.rowHints.length;n++)if(o=this.puzzle.rowHints[n],i=this.puzzle.getRowCells(n)){for(r=new z({type:"row",index:n,length:this.puzzle.width,cells:i}),l=0;l<o.length;l++)s=o[l],r.sections.push({index:l,length:s,possibleStartIndexes:c,knownIndexes:[],solved:!1}),r.minimumSectionLength+=s+1;r.minimumSectionLength--,this.lines.push(r)}for(a=0;a<this.puzzle.columnHints.length;a++){for(u=this.puzzle.columnHints[a],r=new z({type:"column",index:a,length:this.puzzle.height,cells:this.puzzle.getColumnCells(a)}),l=0;l<u.length;l++)s=u[l],r.sections.push({index:l,length:s,possibleStartIndexes:h,knownIndexes:[],solved:!1}),r.minimumSectionLength+=s+1;r.minimumSectionLength--,this.lines.push(r)}}},{key:"_setCellSolution",value:function(e,t){var n,o,i,r,l,s,a;if(null===e.aiSolution)for(n=0;n<this.lines.length;n++)if(i="row"===(o=this.lines[n]).type&&o.index===e.row,r="column"===o.type&&o.index===e.column,l=0,i||r){for(s=0;s<o.cells.length;s++)(a=o.cells[s]).index===e.index?(a.aiSolution=t,l++):null!==a.aiSolution&&l++;l===o.length&&(o.solved=!0)}}},{key:"_log",value:function(e,t){this.solutionLog.push({html:e,cssClass:t||"info"})}},{key:"_getTotalSolved",value:function(){var e,t=0;for(e=0;e<this.puzzle.cells.length;e++)t+=null!==this.puzzle.cells[e].aiSolution;return t}},{key:"_getProgress",value:function(){var e,t,n,o=0,i=0;for(e=0;e<this.lines.length;e++)for(o+=(t=this.lines[e]).sections.length*("row"===t.type?this.puzzle.width:this.puzzle.height),n=0;n<t.sections.length;n++)i+=t.sections[n].possibleStartIndexes.length;return o-i}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,k(o.key),o)}}function k(e){var t=function(e,t){if("object"!=P(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=P(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==P(t)?t:String(t)}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"_populatePuzzleFromGrid",value:function(e,t){var n,o,i,r,l,s,a,u,c,h,d;for(e.reset(),e.grid=t,o=0;o<e.grid.length;o++){for(i=e.grid[o],c=[],e.rowHints[o]=[],r=0;r<i.length;r++)a=l=i[r],u=r>0?e.grid[o][r-1]:0,e.cells.push(new m({index:o*e.width+r,column:r,row:o,solution:l})),1===a&&0===u?c.push(1):0===a&&1===u?c.push(0):1===a&&1===u&&c[c.length-1]++;for(h=0;h<c.length;h++)(d=c[h])>0&&e.rowHints[o].push(d)}for(r=0;r<e.width;r++){for(e.columnHints[r]=[],n=[],s=r;s<e.totalCells;s+=e.width)i=Math.floor(s/e.width),a=e.grid[i][r],u=i>0?e.grid[i-1][r]:0,1===a&&0===u?n.push(1):0===a&&1===u?n.push(0):1===a&&1===u&&n[n.length-1]++;for(h=0;h<n.length;h++)(d=n[h])>0&&e.columnHints[r].push(d)}return e}}],(n=[{key:"createRandom",value:function(t,n,o){var i,l,s,a,c,h,d,f,m=(new Date).getTime(),p=!1,g="number"==typeof o&&o>=0&&o<=1;for(this.puzzle=new u(t,n),this._reset();!1===p;){for(l=g?o:r.getRandomIntBetween(200,800)/1e3,s=[],a=[],i=0,this._log("Creating random "+this.puzzle.width+"x"+this.puzzle.height+" puzzle with density of "+l+"..."),d=0;d<this.puzzle.totalCells;d++)i+=c=Math.random()<l?1:0,d%this.puzzle.width==0&&d>0&&(s.push(a),a=[]),a.push(c);0!==i?i!==this.puzzle.totalCells?(s.push(a),this.puzzle=e._populatePuzzleFromGrid(this.puzzle,s),(h=new C(this.puzzle)).solve()?(p=!0,f=((new Date).getTime()-m)/1e3,this._log("Puzzle is solvable - solved in "+h.elapsedTime+" seconds"),this._logLine(),this._log("Puzzle generated in "+f+" seconds."),this.creationTime=f,this.solvingTime=h.elapsedTime):this._log("Puzzle cannot be solved.  Trying again..."),this._logLine()):this._log("Generated puzzle has all cells filled.  Trying again..."):this._log("Generated puzzle has no cells filled.  Trying again...")}return this.puzzle.creator=this,this.puzzle}},{key:"createFromGrid",value:function(t){var n,o,i=new Date,r=0,l=0;if(this._reset(),this._log("creating puzzle from grid array."),!(t instanceof Array))throw"grid is not an array";return t.forEach((function(e,t){if(!(e instanceof Array))throw"grid is not a multi-dimensional array";if(0===r)r=e.length;else if(e.length!==r)throw"row "+t+" has an invalid length ("+e.length+") - expecting "+r;l++})),this._log("grid is valid"),this._log("populating "+r+"x"+l+" puzzle"),n=new u(r,l),this.puzzle=e._populatePuzzleFromGrid(n,t),this.puzzle.creator=this,new C(this.puzzle).solve()?(this._log("Puzzle is solvable."),this._logLine(),o=((new Date).getTime()-i)/1e3,this._log("Puzzle built and solved in "+o+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"createFromHints",value:function(e){var t,n,o,i,r,l=this,s=new Date;if(this._reset(),this._log("creating puzzle from hints"),"object"!==P(e)||!e.row||!e.column)throw'parameter passed to createFromHints() must be an object containing "row" and "column" properties';if(!(e.row instanceof Array&&e.column instanceof Array))throw"hints.row or hints.column must be an array.";return this._log("found row and column hints"),t=e.column.length,n=e.row.length,(o=new u(t,n)).rowHints=e.row,o.columnHints=e.column,o.creator=this,this._log("populating "+t+"x"+n+" puzzle"),o.grid.forEach((function(e,t){e.forEach((function(e,n){o.cells.push(new m({index:t*o.width+n,column:n,row:t}))}))})),this.puzzle=o,(i=new C(this.puzzle)).solve()?(this._log("Puzzle is solvable."),this._logLine(),i.puzzle.cells.forEach((function(e,t){var n=l.puzzle.getCellByIndex(t);n.aiSolution=e.aiSolution,n.solution=e.aiSolution})),r=((new Date).getTime()-s)/1e3,this._log("Puzzle built and solved in "+r+" seconds."),this._logLine(),this.puzzle):(this._log("Puzzle cannot be solved."),this._logLine(),!1)}},{key:"_log",value:function(e){this.log.push(e)}},{key:"_logLine",value:function(){this.log.push("-----------------------------------")}},{key:"_reset",value:function(){this.log=[],this.creationTime=0,this.solvingTime=0}}])&&_(t.prototype,n),o&&_(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,q(o.key),o)}}function q(e){var t=function(e,t){if("object"!=x(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=x(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:String(t)}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.path=n,this.html="",this.onLoadedCallbacks=[],this.isLoaded=!1,this.loadedPromise=null}var t,n;return t=e,(n=[{key:"onLoad",value:function(e){this.onLoadedCallbacks.push(e)}},{key:"fireOnLoaded",value:function(){this.onLoadedCallbacks.forEach((function(e){e()}))}},{key:"load",value:function(){var e=this;return this.loadedPromise=new Promise((function(t){fetch(e.path).then((function(n){if(!n.ok)throw'loading failed for "'+e.path+'"';n.text().then((function(n){e.html=n,e.isLoaded=!0,e.fireOnLoaded(),t(e.name+" loaded and parsed")}))}))})),this.loadedPromise}},{key:"getNode",value:function(){var e=document.createElement("div");return e.innerHTML=this.html,e}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),j={Arnaud:{width:26,height:10,hints:{row:[[5,5,5,5],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,5,4,4],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[5,1,1,1,5]],column:[[10],[1,1],[1,1],[1,1],[1,1],[],[],[10],[1,1],[1,1],[1,1],[10],[],[],[10],[1,1],[1,1],[1,1],[1],[],[],[10],[1,1,1],[1,1,1],[1,1,1],[1,1]]}},"Small Example 1":{width:8,height:8,solutionGrid:[[0,0,0,0,1,1,1,0],[0,0,0,1,1,1,1,1],[0,0,0,1,1,1,1,1],[1,1,0,0,1,1,1,0],[0,1,0,1,1,1,1,1],[1,1,0,1,0,0,0,1],[1,1,0,1,1,1,1,1],[1,0,0,0,1,1,1,0]]},"Small Example 2":{width:8,height:8,hints:{row:[[3],[5],[5],[2,3],[1,5],[2,1,1],[2,5],[1,3]],column:[[1,3],[4],[],[2,3],[5,2],[5,2],[5,2],[2,3]]}},"Small Example 3":{width:10,height:10,hints:{column:[[3],[1,1],[1],[6],[8],[2,1],[4,1],[10],[3,1],[3]],row:[[4],[5],[2,3],[2,3],[2,1],[2,1],[2,1],[10],[1,1,1],[2,1,1]]}},"Medium Example 1":{width:16,height:18,hints:{column:[[5],[4,3,3],[7,6,2],[4,3,4,1],[3,2,4,1,2],[2,6,4],[3,3,1,1],[4,6,4],[6,4,1,1],[4,3,4,1],[7,6,2],[4,3,3],[5],[3],[5,3,3],[2,4,1,2]],row:[[5],[9],[3,5],[3,5,1],[4,4,2],[2,1,1,2,1],[2,2,1],[2,3,2,1],[7,2],[9,1],[2,2,2,2,2],[3,2,2,3,2],[4,1,1,6],[1,2,2,2],[16],[2,1,1,1,1,2,1],[2,2,2,2,2],[9,1]]}},"Medium Example 2":{width:15,height:15,hints:{column:[[4],[3,1],[2,3],[1,2,2],[1,2,1],[1,1,1,1],[4,3,3],[2,2,4,3],[1,2,5,1],[1,2,4,1],[1,2,5,1],[2,2,4,3],[9,3],[5,1,1],[6,1]],row:[[4,5],[3,2,2],[2,1,1],[1,4,3],[2,9],[2,8],[2,3],[12],[1,7,1],[9],[5],[1,1],[2,2],[3,3],[1,7,1]]}},"Large Example 1":{width:30,height:30,hints:{column:[[19,9],[13,1,2,1,5],[11,4,1,1,2,3],[10,6,1,4,1,1],[9,7,1,1,3,2],[3,4,11,1,6],[2,1,2,3,3,3,7],[2,2,1,2,4,3,8],[3,2,2,1,2,6,7],[1,3,3,4,1,4,4,1],[5,4,2,5,2,2],[1,3,11,1,2,4],[3,2,14,5],[2,2,1,14,7],[1,2,2,2,10,2],[2,1,3,2,6,3,3],[5,6,6,2,2,4],[6,4,4,3,3,3],[6,3,2,1,1,3,5,2],[6,1,2,2,2,2,2,3],[7,1,9,2,4],[7,3,1,2,2,3],[8,2,5,4,3],[6,1,7,11],[5,1,3,2,12],[5,2,2,2,3,11],[4,5,4,3,10],[3,14,10],[3,3,5,2,9],[4,3,3,10]],row:[[10,19],[9,1,2,15],[6,1,1,1,14],[5,2,3,2,11,1],[6,7,11,1],[7,5,7,3],[8,4,3,4],[6,4,5,1,4,1],[5,8,6,2,1],[4,10,3,3,3,1],[3,3,5,2,4,2,2],[2,3,3,3,2,4,2,3],[2,3,1,1,5,2,1,6],[1,4,3,4,2,2,2,4],[1,4,3,4,5,3,3],[1,5,5,2,1,4,1,1],[1,15,3,2,3,1],[2,4,7,2,2,3,1],[1,4,4,7,2,1,3],[1,2,3,4,3,3,1],[1,1,3,5,2,6,1],[1,1,1,4,4,9],[2,3,1,1,1,9],[1,2,4,1,1,6,8],[1,10,1,7,7],[2,8,2,1,2,1,7],[3,6,3,1,1,1,7],[4,4,4,3,11],[3,5,20],[2,7,19]]}}};function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,H(o.key),o)}}function H(e){var t=function(e,t){if("object"!=A(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=A(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==A(t)?t:String(t)}var I=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=document.querySelector("head"),i=document.createElement("link");this.boardSizes=[{name:"Tiny",handle:"tiny",size:1},{name:"Small",handle:"small",size:2},{name:"Medium",handle:"medium",size:3},{name:"Large",handle:"large",size:4}],this.boardSize=this.boardSizes[2],this.themePath=t||"./themes/default",this.themeStylesheetPath=this.themePath+"/styles.css",i.rel="stylesheet",i.type="text/css",i.href=this.themeStylesheetPath,o.prepend(i),this.templatesLoaded=[],this.themeTemplatesPath=this.themePath+"/templates",this.templates=[new T("gameControls",this.themeTemplatesPath+"/controls-game.html"),new T("generateControls",this.themeTemplatesPath+"/controls-generate.html"),new T("console",this.themeTemplatesPath+"/console.html"),new T("previewGrid",this.themeTemplatesPath+"/preview-grid.html"),new T("puzzleGrid",this.themeTemplatesPath+"/puzzle-grid.html")],this.templates.forEach((function(e){n.templatesLoaded.push(e.load())})),this.mouseDown=!1,this.selection=new Set}var t,n,o;return t=e,o=[{key:"_keypressCallback",value:function(e){e.key&&"x"===e.key&&document.querySelector("#nonogram-puzzle-fill-mode").dispatchEvent(new MouseEvent("click"))}}],(n=[{key:"draw",value:function(e){var t=this;this.puzzle=e,Promise.all(this.templatesLoaded).then((function(){t.drawGenerateControls(),t.drawPuzzle(e),t.drawGameControls(),t.drawConsole()}))}},{key:"drawPuzzle",value:function(e){var t=this;Promise.all(this.templatesLoaded).then((function(){var n=t._getTemplate("puzzleGrid");if(t.puzzle=e,t.gridContainer=document.querySelector("[data-nonogram-puzzle-grid]"),t.gridContainer){var o=t.gridContainer,i=n.getNode(),r=i.querySelector("[data-nonogram-puzzle-grid-table-thead-th]"),l=i.querySelector("[data-nonogram-puzzle-grid-table-row]"),s={tl:0,tr:t.puzzle.width-1,bl:t.puzzle.width*t.puzzle.height-t.puzzle.width,br:t.puzzle.width*t.puzzle.height-1};t.puzzle.columnHints.forEach((function(e,t){var n=document.importNode(r.content,!0).querySelector("th"),o=n.querySelector(".fill");n.setAttribute("data-column",t.toString()),n.classList.add("hint","top"),e.forEach((function(e){var t=document.createElement("span");t.textContent=e,o.appendChild(t)})),r.parentNode.insertBefore(n,r)})),t.puzzle.grid.forEach((function(e,n){var o=t.puzzle.getRowCells(n),i=document.importNode(l.content,!0).querySelector("tr"),r=i.querySelector("[data-nonogram-puzzle-grid-table-cell]"),a=i.querySelector("[data-row-hints] .fill");i.setAttribute("data-row",n.toString()),t.puzzle.rowHints[n].forEach((function(e){var t=document.createElement("span");t.textContent=e,a.appendChild(t)})),o.forEach((function(e){var t=document.importNode(r.content,!0).querySelector("td");t.setAttribute("data-index",e.index),t.setAttribute("data-column",e.column),t.setAttribute("data-row",e.row),t.classList.add("puzzle-cell","flippable"),Object.keys(s).forEach((function(n){e.index===s[n]&&t.classList.add(n)})),i.appendChild(t)})),l.parentNode.appendChild(i)})),o.innerHtml=o.textContent="",o.appendChild(i),document.querySelector("[data-nonogram-puzzle-grid-table]").classList.add(t.boardSize.handle),t._resizeBoardForAvailableScreen(),t._makePuzzlePlayable(),t.drawPreview("userSolution")}}))}},{key:"drawGameControls",value:function(){var t=this;Promise.all(this.templatesLoaded).then((function(){var n,o=t._getTemplate("gameControls"),i=document.querySelector("[data-nonogram-game-controls]"),r=o.getNode();i&&(i.innerHtml=i.textContent="",i.appendChild(r),(n=document.querySelector("#nonogram-puzzle-fill-mode")).addEventListener("change",(function(){var e=document.querySelector('[for="nonogram-puzzle-fill-mode"]'),o=e.querySelector(".active"),i=e.querySelector(".inactive");o.classList.remove("active"),o.classList.add("inactive"),i.classList.remove("inactive"),i.classList.add("active"),n.checked?(e.classList.add("on"),t.playerClickMode=0):(e.classList.remove("on"),t.playerClickMode=1)})),window.removeEventListener("keyup",e._keypressCallback),window.addEventListener("keyup",e._keypressCallback))}))}},{key:"drawGenerateControls",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){var t,n,o,i,r,l,s,a,u,c,h,d,f,m,p=e._getTemplate("generateControls"),g=document.querySelector("[data-nonogram-generate-controls]"),v=p.getNode(),y=v.querySelector("[data-nonogram-generate-width]"),z=v.querySelector("[data-nonogram-generate-height]"),S=v.querySelector("[data-nonogram-generate-width-options]"),b=v.querySelector("[data-nonogram-generate-height-options]"),w=v.querySelector("[data-nonogram-choose-predefined]"),C=v.querySelector("[data-nonogram-board-size]"),P=v.querySelector("[data-nonogram-board-size-options]");if(g){if(y&&z)for(t=5;t<=30;t++)n=document.importNode(S.content,!0),o=document.importNode(b.content,!0),(i=n.querySelector("option")).textContent=i.value=t,(r=o.querySelector("option")).textContent=r.value=t,e.puzzle.width===t&&i.setAttribute("selected","selected"),e.puzzle.height===t&&r.setAttribute("selected","selected"),y.appendChild(i),z.appendChild(r);w&&Object.keys(j).forEach((function(t){l=document.importNode(S.content,!0),(s=l.querySelector("option")).textContent=s.value=t,t===e.selectedExample&&s.setAttribute("selected","selected"),w.appendChild(s)})),C&&e.boardSizes.forEach((function(t){c=document.importNode(P.content,!0),(h=c.querySelector("option")).value=t.handle,h.textContent=t.name,t.handle===e.boardSize.handle&&h.setAttribute("selected","selected"),C.appendChild(h)})),g.innerHtml=g.textContent="",g.appendChild(v),m=document.querySelector("[data-nonogram-generate-button]"),a=document.querySelector("[data-nonogram-choose-predefined]"),u=document.querySelector("[data-nonogram-board-size]"),d=document.querySelector("[data-nonogram-game-reset]"),f=document.querySelector("[data-nonogram-game-solve]"),m&&m.addEventListener("click",(function(){var t=document.querySelector("[data-nonogram-generate-width]"),n=document.querySelector("[data-nonogram-generate-height]"),o=t.value,i=n.value,r=(new L).createRandom(o,i,null);e.selectedExample=null,e.draw(r),e._resizeBoardForAvailableScreen()})),a&&a.addEventListener("change",(function(){var t,n,o=new L;""!==a.value&&(Object.keys(j).forEach((function(i){a.value===i&&(t=j[i],e.selectedExample=i,t.solutionGrid?n=o.createFromGrid(t.solutionGrid):t.hints&&(n=o.createFromHints(t.hints)))})),n&&(e.draw(n),e._resizeBoardForAvailableScreen()))})),u&&u.addEventListener("change",(function(){e.boardSizes.forEach((function(t){t.handle===u.value&&e._changeBoardSize(t)}))})),d&&d.addEventListener("click",(function(){e._resetPuzzle()})),f&&f.addEventListener("click",(function(){e.drawSolution(),e.drawPreview("solution"),e._showPuzzleSolved()}))}}))}},{key:"drawConsole",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){var t=e._getTemplate("console"),n=document.querySelector("[data-nonogram-console]"),o=t.getNode(),i=o.querySelector("[data-nonogram-console-output]"),r=o.querySelector("[data-nonogram-console-line]");n&&(e.puzzle.creator instanceof L&&e.puzzle.creator.log.forEach((function(e){var t=document.importNode(r.content,!0).querySelector("code");t.textContent=e.toString(),i.appendChild(t)})),n.innerHtml=n.textContent="",n.appendChild(o))}))}},{key:"drawPreview",value:function(e){var t=this;Promise.all(this.templatesLoaded).then((function(){var n=t._getTemplate("previewGrid"),o=document.querySelector("[data-nonogram-preview-grid]"),i=n.getNode();o.innerHtml=o.textContent="",o.appendChild(i.querySelector("[data-nonogram-preview]"));var r,l=document.querySelector("[data-nonogram-preview-canvas]"),s=l.getContext("2d"),a=l.parentElement.parentElement.parentElement,u=a.offsetWidth,c=a.offsetHeight,h=u/c,d=t.puzzle.width/t.puzzle.height;r=h>d?Math.floor(c/t.puzzle.height):Math.floor(u/t.puzzle.width),l.width=r*t.puzzle.width,l.height=r*t.puzzle.height,t.puzzle.cells.forEach((function(t){1===t[e]&&s.fillRect(t.column*r,t.row*r,r,r)}))}))}},{key:"drawSolution",value:function(){var e=this;Promise.all(this.templatesLoaded).then((function(){e.gridContainer.querySelectorAll("td.filled").forEach((function(e){e.classList.remove("filled","solution-positive","solution-negative","user-positive","user-negative","flipped")})),e.puzzle.cells.forEach((function(t){var n=e.gridContainer.querySelector('td[data-index="'+t.index+'"]');t.userSolution=t.solution,n.classList.add("user-solved"),1===t.solution?n.classList.add("solution-positive","user-positive","flipped"):n.classList.add("solution-negative","user-negative")}))}))}},{key:"_changeBoardSize",value:function(e){var t=document.querySelector("[data-nonogram-puzzle-grid-table]"),n=document.querySelector("[data-nonogram-board-size]");t&&n&&(t.classList.remove("tiny","small","medium","large"),t.classList.add(e.handle),n.value=e.handle,this.boardSize=e,this.drawPreview())}},{key:"_resizeBoardForAvailableScreen",value:function(){var e,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=this.gridContainer.clientWidth,o=this.boardSizes.sort((function(e,t){return e.size>t.size?-1:1}));if(t.clientWidth>n)for(e=0;e<o.length&&(o[e].size<this.boardSize.size&&this._changeBoardSize(o[e]),!(t.clientWidth<=n));e++);this.drawConsole()}},{key:"_flipCell",value:function(e){var t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=e.getAttribute("data-index"),o=this.puzzle.getCellByIndex(n),i=document.querySelector("[data-nonogram-puzzle-grid-solved]");o.userSolution=o.userSolution===this.playerClickMode?null:this.playerClickMode,t.classList.remove("solved"),e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative"),1===o.userSolution?e.classList.add("user-solved","user-positive"):0===o.userSolution&&e.classList.add("user-solved","user-negative"),e.classList.toggle("flipped"),this.drawPreview("userSolution"),this.puzzle.checkUserSolution()?this._showPuzzleSolved():i.textContent=""}},{key:"_makePuzzlePlayable",value:function(){var e=this,t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),o=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td");this.playerClickMode=1,n.forEach((function(t){t.classList.add("playable"),t.addEventListener("mouseenter",(function(t){var n=t.currentTarget,i=n.getAttribute("data-row"),r=n.getAttribute("data-column"),l="".concat(r,",").concat(i);o.forEach((function(t){var n=t.getAttribute("data-row"),o=t.getAttribute("data-column");n===i||o===r?t.classList.add("row-column-highlight"):t.classList.remove("row-column-highlight"),e.mouseDown&&n===i&&o===r&&!e.selection.has(l)&&(e.selection.add(l),e._flipCell(t))}))})),t.addEventListener("mousedown",(function(t){var n=t.currentTarget;t.preventDefault(),e.mouseDown=!0,e.selection.clear(),e._flipCell(n)}))})),t.addEventListener("mouseleave",(function(){o.forEach((function(e){e.classList.remove("row-column-highlight")}))})),window.addEventListener("mouseup",(function(t){t.preventDefault(),e.mouseDown=!1,e.selection.clear()}))}},{key:"_resetPuzzle",value:function(){var e=this.gridContainer.querySelectorAll(".nonogram-puzzle-grid td.puzzle-cell"),t=this.gridContainer.querySelector(".nonogram-puzzle-grid"),n=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.classList.remove("solved"),n.textContent="",this.puzzle.cells.forEach((function(e){e.userSolution=null})),e.forEach((function(e){e.classList.remove("user-solved","user-positive","user-negative","solution-positive","solution-negative")})),this.gridContainer.querySelector("[data-nonogram-preview-grid]").innerHTML="",this.drawPreview("userSolution")}},{key:"_showPuzzleSolved",value:function(){var e=this.gridContainer.querySelector(".nonogram-puzzle-grid"),t=document.querySelectorAll("[data-nonogram-puzzle-grid-table] .puzzle-cell"),n=document.querySelector("[data-nonogram-puzzle-grid-solved]");t.forEach((function(e){e.classList.remove("row-column-highlight")})),e.classList.add("solved"),n.textContent="Solved!"}},{key:"_getTemplate",value:function(e){var t=this.templates.find((function(t){return t.name===e}));if(!(t instanceof T))throw'"'+e+'" template not found.';return t}}])&&O(t.prototype,n),o&&O(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t})()));
//# sourceMappingURL=nonogram.js.map